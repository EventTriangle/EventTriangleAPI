parameters:
  - name: unitTestsProjectPath
    displayName: 'Unit Tests Project Path'
    type: string
    default: './src/sender/EventTriangleAPI.Sender.UnitTests/MangoAPI.Sender.UnitTests.csproj'

jobs:
  - job: 'Build_Test_Dotnet'
    displayName: 'Build Test .NET'
    steps:
      - checkout: self
        fetchDepth: 0

      - task: UseDotNet@2
        displayName: 'Install .NET 6.x SDK'
        inputs:
          packageType: sdk
          version: 6.x

      - task: DotNetCoreCLI@2
        displayName: 'Dotnet restore'
        inputs:
          command: 'restore'
          projects: './src/sender/EventTriangleAPI.Sender.IntegrationTests/EventTriangleAPI.Sender.IntegrationTests.csproj'
          arguments: '--verbosity minimal'

      - task: DotNetCoreCLI@2
        displayName: 'Dotnet build Release'
        inputs:
          command: 'build'
          projects: './src/sender/EventTriangleAPI.Sender.IntegrationTests/EventTriangleAPI.Sender.IntegrationTests.csproj'
          arguments: '--configuration Release --no-restore'

      - task: DotNetCoreCLI@2
        displayName: 'Run unit tests'
        inputs:
          command: 'test'
          projects: './src/sender/EventTriangleAPI.Sender.UnitTests/MangoAPI.Sender.UnitTests.csproj'

      - task: DotNetCoreCLI@2
        displayName: 'Run integration tests'
        inputs:
          command: 'test'
          projects: './src/sender/EventTriangleAPI.Sender.IntegrationTests/EventTriangleAPI.Sender.IntegrationTests.csproj'
          arguments: '--no-restore'

      - task: PublishTestResults@2
        inputs:
          testRunner: VSTest
          testResultsFiles: '$(Agent.TempDirectory)/**/*.trx'
